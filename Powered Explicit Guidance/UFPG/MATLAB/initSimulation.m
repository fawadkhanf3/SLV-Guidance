%initSimulation.m
%Initialization module. Cleans up some vehicle-related variables, sets up
%orbiting body (Earth) parameters and atmosphere curves (data from
%RealSolarSystem\RSSKopernicus.cfg).

global g0;          %std gravity asl [m/s2]
g0 = 9.80665;

global mu;          %std gravity param for Earth [m3/s2]
mu = 398600441800000;

global R;           %Earth radius [m]
R = 6371000;

global period;      %Earth rotation period [s]
period = 24*3600;

global convergenceCriterion;    %for UPFG
convergenceCriterion = 0.01;

%Thrust profiles are done somewhat globally, basing on STS SRB profile.
%Generator function checks for scaleTo variable to automatically scale the
%profile in time if we want to make a faster or slower burning SRB.
%Once set, this variable might affect other vehicles, so best to delete it.
clearvars scaleTo

%Payloads are done in a similar way, so...
clearvars payload

%altitude [km] vs pressure [atm]
if ~exist('atmpressure', 'var')
    global atmpressure;
    atmpressure = [ 0.0                  1.0                    ;
                    1.5512810696042834   0.8293033334108524     ;
                    3.049490512617914    0.6877017510446373     ;
                    4.496387604836978    0.5702444163147664     ;
                    5.893677091578151    0.47282126627696414    ;
                    7.243010623061255    0.3920205567378669     ;
                    8.545988169576226    0.3250104789672165     ;
                    9.804159415369073    0.26944079326066694    ;
                    11.01902513031035    0.2233611050921582     ;
                    11.84014685339708    0.19632505252876972    ;
                    12.661479569463696   0.17256150402323664    ;
                    13.483023359760763   0.1516743473174663     ;
                    14.304778305580532   0.1333154167235328     ;
                    15.12674448825698    0.1171786895168694     ;
                    15.948921989165822   0.10299518481855771    ;
                    16.771310889724543   0.09052847993471885    ;
                    17.593911271392436   0.07957076941364262    ;
                    18.416723215670608   0.06993940112805067    ;
                    19.239746804102023   0.06147383164159355    ;
                    20.062982118274434   0.05403295010784879    ;
                    20.848089497565947   0.04778939820639058    ;
                    21.63620936661535    0.042267349078245586   ;
                    22.42735394519108    0.037383419911108245   ;
                    23.221535507546527   0.03306386499304308    ;
                    24.018766382699184   0.029243461811422816   ;
                    24.8190589547115     0.025864525910496747   ;
                    25.622425662973434   0.022876039623080074   ;
                    26.42887900248672    0.02023288151260161    ;
                    27.238431524150865   0.017895144883579222   ;
                    28.05109583505088    0.01582753506445577    ;
                    28.86688459874678    0.013998836357006461   ;
                    29.685810535564812   0.012381440599191202   ;
                    30.50788642289051    0.010950930219291178   ;
                    31.333125095463508   0.009685709482500008   ;
                    32.16153944567676    0.00856667835929167    ;
                    32.938227246035915   0.007641143253424154   ;
                    33.72239861830024    0.006815621618893492   ;
                    34.514127125411996   0.00607930403304661    ;
                    35.31348708126911    0.005422549546182163   ;
                    36.12055355892001    0.004836759353067881   ;
                    36.93540239885774    0.004314264124281222   ;
                    37.758110217414796   0.0038482235201537335  ;
                    38.588754415260034   0.0034325365698691804  ;
                    39.42741318599914    0.003061761740754522   ;
                    40.274165524880075   0.002731045649879268   ;
                    41.12909123760493    0.0024360594834088893  ;
                    41.992270949249814   0.0021729422902310026  ;
                    42.86378611329412    0.0019382504065130982  ;
                    43.74371902076092    0.0017289123482408188  ;
                    44.63215280946986    0.001542188580481708   ;
                    45.52917147340433    0.0013756356360598086  ;
                    46.434859872194416   0.0012270741133522903  ;
                    47.34930374071258    0.0010945601337771134  ;
                    48.364384412817486   0.0009647618356676518  ;
                    49.379785586778326   0.0008503557210569973  ;
                    50.39550741421541    0.0007495164938529389  ;
                    51.41155004684329    0.0006606353132858362  ;
                    52.60233679755664    0.0005693036016959514  ;
                    53.77919611346216    0.0004905938576126548  ;
                    54.94228410298658    0.0004227624006014844  ;
                    56.091755284696234   0.00036430633500513854 ;
                    57.22776259968469    0.0003139303145738763  ;
                    58.35045742395875    0.0002705178923931361  ;
                    59.45998958082039    0.00023310682382008942 ;
                    60.556507353241216   0.00020086777728288698 ;
                    61.64015749622714    0.00017308598293538365 ;
                    62.711085249170246   0.00014914541394851294 ;
                    63.76943434818539    0.00012851515108212665 ;
                    64.815347038429      0.00011073762934697615 ;
                    65.84896408639746    0.00009541850709542147 ;
                    66.8704247922031     0.00008221793368536839 ;
                    67.87986700182476    0.00007084302273310274 ;
                    68.8774271193317     0.00006104136458678227 ;
                    69.86324011907763    0.000052595434599546184;
                    70.8374395578637     0.00004531777356493782 ;
                    71.80015758707647    0.000039046833733439246;
                    72.68865461815959    0.00003398575432010344 ;
                    73.57022854353788    0.000029580547160393628;
                    74.44493098881618    0.000025746233592392944;
                    75.31281323119997    0.000022408843008637936;
                    76.17392620126307    0.00001950398719402563 ;
                    77.02832048471646    0.00001697561926004407 ;
                    77.87604632417766    0.000014774953279356489;
                    78.71715362094046    0.00001285952381730844 ;
                    79.551691936745      0.000011192367249356912;
                    80.37971049554787    9.741309097476518e-6   ;
                    81.20125818529202    8.478343659349097e-6   ;
                    82.01638355967633    7.379093980827345e-6   ;
                    82.82513483992473    6.422341768933253e-6   ;
                    83.62755991655452    5.589618189260209e-6   ;
                    84.42370635114384    4.864847663982511e-6   ;
                    85.2136213780981     4.234037807288761e-6   ;
                    85.99735190641914    3.6850095235747807e-6  ;
                    86.77126507788661    3.2092787757787186e-6  ;
                    87.53914411678717    2.794954292752292e-6   ;
                    88.30103431720043    2.4341112574484694e-6  ;
                    89.05698066083089    2.119847408523293e-6   ;
                    89.80702781872314    1.846151123042689e-6   ;
                    90.55122015297522    1.6077865140798708e-6  ;
                    91.28960171845002    1.4001933490614182e-6  ;
                    92.00550873461046    1.2333118599412074e-6  ;
                    92.72423273172485    1.0863213945314536e-6  ;
                    93.44578535382313    9.568509390520772e-7   ;
                    94.17017829735393    8.428121226896023e-7   ;
                    94.89742331145317    7.423655223488129e-7   ;
                    95.62753219821417    6.538909846164284e-7   ;
                    96.3605168129594     5.759614859695728e-7   ;
                    97.09638906451391    5.073201093718896e-7   ;
                    97.83516091548039    4.46859765699811e-7    ;
                    98.57684438251582    3.936053327437919e-7   ;
                    99.32145153660994    3.466979235488415e-7   ;
                    100.0689945033653    3.053810302255262e-7   ;
                    100.81948546327908   2.6898831963163175e-7  ;
                    101.57293665202647   2.3693288398456065e-7  ;
                    102.32936036074604   2.0869777294549137e-7  ;
                    103.08876893632655   1.838276543975248e-7   ;
                    103.85117478169572   1.6192146935538855e-7  ;
                    104.61659035611073   1.426259624876361e-7   ;
                    105.38502817545033   1.2562998386281498e-7  ;
                    106.15650081250897   1.1065946997674138e-7  ;
                    106.9310208972926    9.747302307980794e-8   ;
                    107.70860111731623   8.585801747804816e-8   ;
                    108.4892542179035    7.562716998532403e-8   ;
                    109.27299300248785   6.661551919379164e-8   ;
                    110.05983033291581   5.867776482658846e-8   ;
                    110.84977912975185   5.168592424694919e-8   ;
                    111.64285237258542   4.552726831549305e-8   ;
                    112.43906310033962   4.010250329483534e-8   ;
                    113.23842441158197   3.532416947066346e-8   ;
                    114.04094946483697   3.1115230655123596e-8  ;
                    114.84665147890068   2.740783181815693e-8   ;
                    115.65554373315715   2.4142204805057678e-8  ;
                    116.46763956789694   2.1265704487747348e-8  ;
                    117.28295238463754   1.8731959801643352e-8  ;
                    118.10149564644574   1.6500125973500722e-8  ;
                    118.92328287826211   1.4534225878138631e-8  ;
                    119.74832766722746   1.2802569899865155e-8  ;
                    120.57664366301124   1.1277244940900727e-8  ;
                    121.40824457814219   9.933664334603154e-9   ;
                    122.2431441883408    8.750171403809505e-9   ;
                    123.08135633285417   7.707690270003333e-9   ;
                    123.92289491479256   6.7894182812367484e-9  ;
                    124.7677739014685    5.980555098096755e-9   ;
                    125.61600732473762   5.268064068329123e-9   ;
                    126.46760928134195   4.640462041568822e-9   ;
                    127.32259393325515   4.087634234370453e-9   ;
                    128.18097550803      3.6006711597960495e-9  ;
                    129.0427682991481    3.171724991706807e-9   ;
                    129.90798666637178   2.7938830473793276e-9  ;
                    130                  0.0                    ; ];
end
% altitude [km] vs temperature [C]
if ~exist('atmtemperature', 'var')
    global atmtemperature;
    atmtemperature = [ 0.0                  15.0                ;
                       0.5873532661402939   11.182555706237338  ;
                       1.1708835840211225   7.3906551726050225  ;
                       1.7505894467842473   3.624294347296768   ;
                       2.326469355432374    -0.11653078269370098;
                       2.8985218188122817   -3.8318241914215605 ;
                       3.4667453535972417   -7.521589813835249  ;
                       4.031138484268703    -11.185831545616793 ;
                       4.591699743097215    -14.824553243017135 ;
                       5.148427670122567    -18.437758722686567 ;
                       5.701320813133119    -22.02545176150059  ;
                       6.250377727644286    -25.587636096380322 ;
                       6.795596976876166    -29.124315424107493 ;
                       7.336977131730267    -32.63549340113431  ;
                       7.874516770765299    -36.121173643387124 ;
                       8.408214480172017    -39.581359726064505 ;
                       8.93806885374706     -43.016055183428875 ;
                       9.464078492865767    -46.42526350859214  ;
                       9.986242006453917    -49.80898815329434  ;
                       10.504558010958375   -53.167232527675424 ;
                       11.01902513031035    -56.5               ;
                       20.062982118274434   -56.5               ;
                       20.98084654897413    -55.5880202565871   ;
                       21.9008389620091     -54.67418896100597  ;
                       22.8229605287171     -53.75850666193023  ;
                       23.747212423371924   -52.84097390917117  ;
                       24.673595823186716   -51.92159125367721  ;
                       25.602111908317323   -51.000359247533595 ;
                       26.53276186186562    -50.07727844396172  ;
                       27.46554686988287    -49.15234939731894  ;
                       28.400468121373088   -48.22557266309792  ;
                       29.337526808296396   -47.296948797926234 ;
                       30.27672412557241    -46.36647835956603  ;
                       31.218061271083617   -45.4341619069134   ;
                       32.16153944567676    -44.5               ;
                       32.82294660742017    -42.666806255917464 ;
                       33.48710277233055    -40.82637421834721  ;
                       34.154009078612766   -38.97870535550513  ;
                       34.823666669121195   -37.12380114207147  ;
                       35.496076691365815   -35.26166305918406  ;
                       36.17124029751821    -33.39229259443138  ;
                       36.84915864441759    -31.5156912418461   ;
                       37.529832893576796   -29.63186050189853  ;
                       38.213264211188296   -27.74080188148986  ;
                       38.899453768130186   -25.842516893946026 ;
                       39.58840273997215    -23.93700705901128  ;
                       40.28011230698143    -22.024273902841713 ;
                       40.97458365412876    -20.104318957999368 ;
                       41.67181797109436    -18.177143763445997 ;
                       42.37181645227385    -16.242749864536734 ;
                       43.07458029678417    -14.301138813014575 ;
                       43.78011070846955    -12.352312167004072 ;
                       44.48840889590738    -10.396271491005507 ;
                       45.19947607241417    -8.43301835588943   ;
                       45.91331345605142    -6.4625543388903    ;
                       46.629922269631564   -4.484881023601417  ;
                       47.34930374071258    -2.5                ;
                       51.41155004684329    -2.5                ;
                       52.15213108353106    -4.540325693286491  ;
                       52.89004297885337    -6.5728299133947985 ;
                       53.625284454668574   -8.597514369303667  ;
                       54.35785423699868    -10.614380762784776 ;
                       55.08775105603217    -12.623430788399048 ;
                       55.81497364612668    -14.62466613349386  ;
                       56.53952074581175    -16.618088478199184 ;
                       57.26139109779142    -18.60369949542431  ;
                       57.98058344894684    -20.58150085085441  ;
                       58.69709655033888    -22.55149420294663  ;
                       59.41092915721056    -24.51368120292659  ;
                       60.122080028989615   -26.46806349478453  ;
                       60.83054792929086    -28.414642715271185 ;
                       61.536331625918585   -30.353420493894077 ;
                       62.2394298908689     -32.284398452913365 ;
                       62.93984150033201    -34.20757820733763  ;
                       63.637565234694456   -36.12296136491932  ;
                       64.33259987854133    -38.03054952615099  ;
                       65.02494422065837    -39.930344284260286 ;
                       65.71459705403412    -41.82234722520562  ;
                       66.40155717586185    -43.706559927671464 ;
                       67.0858233875417     -45.58298396306344  ;
                       67.76739449468249    -47.45162089550365  ;
                       68.44626930710369    -49.31247228182542  ;
                       69.12244663883719    -51.165539671568524 ;
                       69.79592530812911    -53.010824606973586 ;
                       70.46670413744148    -54.848328622976965 ;
                       71.13478195345398    -56.6780532472053   ;
                       71.80015758707647    -58.5               ;
                       72.61330146122056    -60.09004159019099  ;
                       73.4235813878142     -61.67408380840237  ;
                       74.2309958642791     -63.252128092591676 ;
                       75.0355433928183     -64.82417587481251  ;
                       75.8372224804201     -66.39022858121263  ;
                       76.636031638862      -67.9502876320322   ;
                       77.4319693847145     -69.50435444160118  ;
                       78.225034239345      -71.05243041833751  ;
                       79.01522472892147    -72.59451696474463  ;
                       79.80253938441622    -74.13061547740938  ;
                       80.5869767416096     -75.66072734699961  ;
                       81.3685353410936     -77.1848539582615   ;
                       82.14721372827546    -78.70299669001744  ;
                       82.92301045338111    -80.21515691516328  ;
                       83.69592407145879    -81.72133600066562  ;
                       84.46595314238239    -83.22153530755938  ;
                       85.23309623085487    -84.71575619094494  ;
                       85.99735190641914    -86.20400000000001  ;
                       91.28960171845002    -86.20400000000001  ;
                       92.12832386178835    -85.38891267215413  ;
                       92.96903608064213    -84.5721036221104   ;
                       93.81173937133609    -83.7535733082683   ;
                       94.65643473272092    -82.93332219002036  ;
                       95.50312316617602    -82.11135072775184  ;
                       96.35180567561207    -81.28765938284019  ;
                       97.20248326747372    -80.46224861765484  ;
                       98.05515695074233    -79.6351188955567   ;
                       98.90982773693857    -78.80627068089782  ;
                       99.76649664012515    -77.97570443902097  ;
                       100.62516467690959   -77.14342063625926  ;
                       101.48583286644673   -76.30941973993583  ;
                       102.34850223044162   -75.47370221836343  ;
                       103.21317379315218   -74.6362685408439   ;
                       104.0798485813919    -73.7971191776681   ;
                       104.94852762453256   -72.95625460011516  ;
                       105.81921195450698   -72.11367528045238  ;
                       106.69190260581182   -71.26938169193477  ;
                       107.56660061551021   -70.42337430880454  ;
                       108.44330702323458   -69.57565360629096  ;
                       109.3220228711894    -68.72622006060976  ;
                       110.20274920415396   -67.87507414896282  ;
                       111.08548706948508   -67.02221634953798  ;
                       111.97023751712      -66.16764714150833  ;
                       112.85700159957906   -65.31136700503203  ;
                       113.74578037196856   -64.45337642125193  ;
                       114.6365748919835    -63.59367587229514  ;
                       115.52938621991044   -62.73226584127275  ;
                       116.42421541863025   -61.86914681227927  ;
                       117.32106355362102   -61.00431927039244  ;
                       118.21993169296077   -60.13778370167276  ;
                       119.12082090733038   -59.26954059316307  ;
                       120.02373227001637   -58.399590432888374 ;
                       120.92866685691372   -57.527933709855205 ;
                       121.83562574652883   -56.65457091405142  ;
                       122.74461001998229   -55.77950253644579  ;
                       123.6556207610117    -54.90272906898761  ;
                       124.56865905597468   -54.0242510046063   ;
                       125.4837259938516    -53.14406883721105  ;
                       126.40082266624862   -52.262183061690564 ;
                       127.3199501674004    -51.37859417391243  ;
                       128.24110959417317   -50.49330267072298  ;
                       129.16430204606752   -49.606309049946844 ;
                       130.08952862522133   -48.717613810386524 ;
                       131.0167904364128    -47.827217451822094 ;
                       131.94608858706317   -46.93512047501079  ;
                       132.87742418723982   -46.041323381686595 ;
                       133.81079834965917   -45.14582667455994  ;
                       134.7462121896896    -44.24863085731738  ;
                       135.68366682535438   -43.349736434621036 ;
                       136.62316337733475   -42.44914391210841  ;
                       137.5647029689727    -41.54685379639193  ;
                       138.50828672627412   -40.642866595058564 ;
                       139.4539157779117    -39.737182816669474 ;
                       140.40159125522788   -38.82980297075966  ;
                       141.351314292238     -37.92072756783756  ;
                       142.303086025633     -37.00995711938464  ;
                       143.25690759478286   -36.09749213785528  ;
                       144.21278014173924   -35.183333136675856 ;
                       145.1707048112387    -34.26748063024499  ;
                       146.1306827507056    -33.349935133932775 ;
                       147.09271511025534   -32.430697164080556 ;
                       148.0568030426972    -31.509767238000506 ;
                       149.0229477035375    -30.587145873975317 ;
                       149.9911502509826    -29.662833591257765 ;
                       150.96141184594208   -28.736830910070353 ;
                       151.9337336520317    -27.809138351604986 ;
                       152.9081168355765    -26.879756438022582 ;
                       153.8845625656139    -25.948685692452557 ;
                       154.86307201389687   -25.015926638992795 ;
                       155.84364635489695   -24.081479802708913 ;
                       156.82628676580737   -23.14534570963403  ;
                       157.8109944265462    -22.207524886768567 ;
                       158.79777051975938   -21.26801786207949  ;
                       159.7866162308241    -20.326825164500406 ;
                       160.77753274785167   -19.383947323930784 ;
                       161.7705212616907    -18.43938487123586  ;
                       162.76558296593052   -17.49313833824604  ;
                       163.762719056904     -16.545208257756826 ;
                       164.76193073369092   -15.59559516352806  ;
                       165.76321919812113   -14.64429959028405  ;
                       166.76658565477774   -13.691322073712627 ;
                       167.77203131100023   -12.73666315046512  ;
                       168.77955737688774   -11.780323358156124 ;
                       169.78916506530223   -10.82230323536271  ;
                       170.8008555918717    -9.862603321624306  ;
                       171.81463017499357   -8.90122415744247   ;
                       172.83049003583758   -7.938166284280101  ;
                       173.84843639834935   -6.973430244561541  ;
                       174.8684704892535    -6.007016581671678  ;
                       175.89059353805683   -5.038925839956221  ;
                       176.91480677705178   -4.069158564720738  ;
                       177.9411114413195    -3.097715302230654  ;
                       178.96950876873325   -2.124596599710628  ;
                       179.99999999996163   -1.1498030053443244 ; ];
end